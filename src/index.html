<!--FIX INITIAL VIEW-->

<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" type="text/css" href="metro-interactive-styles.css">
</head>

<body style="min-height:1000px">
<script src="d3.min.js" type="text/javascript"></script>
<script src="state-tracking.js" type="text/javascript"></script>
<script src="/Mapping/metro-map/map-class.js"></script>
<!--<script src="/home/alec/Projects/quick-map/map-class.js"></script>-->

<div style="position:relative;max-width:950px;width:100%;min-width:320px;min-height:600px;height:100%;margin:auto">
	<div id="metro-index-wrap" class="metro-interactive-wrap"></div>
</div>

<script>
	var el = document.getElementById("metro-index-wrap");
	var MI = MetroInteractive(el);

	var view0 = MI.addView(function(){},null,function(){
		var slide = this.container;
		var header = this.header;
		header.append("p").text("About the Metro Monitor");
		//header.append("p").text("Tracking progress towards an advanced economy that works for all").style({"font-style":"italic","margin-bottom":"0px"});
		//slide.append("hr").style("margin-bottom","20px");
		slide.append("p").style({"font-weight":"bold","color":"#4285f4","margin-bottom":"25px"}).text("[This is space for the opening view. It could be used to convey: 1) What the Monitor is and/or what it measures, 2) Why the Monitor is valuable, and/or 3) A high level overview of the data. It should be snappier than what is here now, and should include at least one graphic. The text here can link to other views in the interactive.]")
		slide.append("div").style({"float":"left","width":"56%","padding":"0% 2% 0px 0px"})
			.html("<p><b>Summary</b></p><p>To help informlocal leaders’ efforts to achieve an advanced economy that worksfor all, the Brookings Metropolitan Policy Program is launching a new<i>Metro Monitor </i>that examines metropolitan areas’ progresstoward improving outcomes in three key areas of economic development:growth, prosperity, and inclusion. Successful economic developmentputs a metropolitan economy on a <u>higher trajectory of long-rungrowth</u> (<i>growth</i>) by<i> </i><u>improving the productivity ofindividuals and firms in order to raise local standards of living</u>(<i>prosperity</i>) <u>for all people</u> (<i>inclusion</i>). ThisMetro Monitor examines indicators within each of these categories forthe 100 largest U.S. metropolitan areas, primarily during therecovery from the Great Recession, and finds that:</p><ol><li><b>Economicgrowth has been widespread but uneven among metropolitan areasduring the recovery from 2009 to 2014.</b>Every metropolitan area saw gains on at least one measure of growth.However, some places boomed while others grew barely at all.Metropolitan areas that specialize in information technology,professional services, energy, or certain types of manufacturing sawespecially strong growth. Growth was slower over the course of therecovery for many metropolitan areas in the Sunbelt and most ofthose in the Northeast.</li><li><b>Whileevery large metropolitan area experienced at least some modestgrowth during the economic recovery, increases in prosperity werenot as widespread.</b>Fast-growing technology strongholds and places that specialize inprofessional services, a sector that has grown since the recessionended and pays well, saw especially large gains in prosperity.Metropolitan areas in the Sunbelt, especially Central and SouthernCalifornia, the Intermountain West, and Florida, ranked among theweakest performers on prosperity during the economic recovery.</li><li><b>Comparedto outcomes in growth and prosperity during the recovery,improvements in inclusion proved more elusive and more fleetingduring the economic recovery. </b>Evenin places that made gains in growth and prosperity, middle- andlow-income workers often fared worse. And disparities between peopleof different races and ethnicities widened. In fact, metropolitanareas that saw among the best improvements for middle- and lo-incomeworkers posted some of the worst outcomes in racial disparity. Andplaces rarely made consistent gains over time.</li><li><b>Thesetrends suggest that, at least during the recovery, few metropolitanareas have simultaneously sustained gains in growth, prosperity, andinclusion. </b>Across the boardsuccess on these outcomes tends to be exceptional. Some metropolitanareas grew by adding jobs while others grew by becoming moreprosperous. Few did well at both. Rising prosperity seldombenefitted middle- and low-wage workers. And even where growth wasinclusive, middle- and low-income whites fared better than middle-and low-income people of color. Metropolitan areas that sustainedabove-average performance over time are more exceptional still</li></ol><p>This edition of the Metro Monitor advances new ways of measuringeconomic success in metropolitan America. It finds that metropolitanareas made great strides on improving growth and competitivenessduring the economic recovery. However, economic growth alone, evengrowth that produces rising living standards, is not enough to assurebetter outcomes for all groups in a metropolitan area. Over the nextseveral months, the Brookings Metropolitan Policy Program willpublish follow-up analyses to help metro leaders understand whatcontributes to growth, prosperity, and inclusion in metropolitanAmerica, and how new models of economic development can help deliveran advanced economy that works for all.</p>")

		slide.append("div").style({"float":"right","width":"36%","padding":"2%","background-color":"#dddddd"})
			.html("<p><b>Categories and indicators</b></p><p>The&nbsp;<i>Metro Monitor&nbsp;</i>measures the performance of the nation’s major metropolitan economies in three critical areas for economic development: growth, prosperity, and inclusion. Successful economic development puts a metropolitan economy on a higher trajectory of long-run growth (<i>growth</i>) by<i>&nbsp;</i>improving the productivity of individuals and firms in order to raise local standards of living (<i>prosperity</i>) for all people (<i>inclusion</i>). This&nbsp;<i>Metro Monitor</i>&nbsp;examines indicators within each of these categories that help assess metropolitan areas’ progress toward shaping an advanced economy for all.</p><p>Growth</p><p>Growth indicators capture net change in the total size of a metropolitan area’s economy. As a metropolitan economy grows, it creates new opportunities for individuals and can become more efficient as it grows larger. The&nbsp;<i>Metro Monitor&nbsp;</i>measures growth in output or gross product, number of jobs, and aggregate wages paid to workers.</p><ul><li><i><b>Change in aggregate output</b></i>—Output measures the total value of goods and services produced in a metropolitan economy, a concept known as gross domestic product at the national level.</li><li><i><b>Change in the number of jobs</b></i>—Jobs measure the total number of occupied full- and part-time employment positions in a metropolitan economy.</li><li><i><b>Change in aggregate income</b></i>—Aggregate income measures the total value of wages, salaries, and benefits paid to workers in a metropolitan economy.</li></ul><p>Changes in these indicators are measured as the percent difference between values in the final and initial years of analysis. Data on output, jobs, and aggregate income come from Moody’s Analytics.</p><p><b>Prosperity</b></p><p>Prosperity indicators indicate the quality and impact of a metropolitan economy’s growth. An economy can grow by adding more inputs, like workers, which may not necessarily make each worker better off. It can also grow by increasing the productivity of its workers, through innovation or by upgrading workers’ skills, for example. This can increase the value of workers’ labor and the compensation they receive for it, as indicated by output per job and the average wage. It can also raise overall standards of living in the metropolitan area, as indicated by output per person.</p><ul><li><i><b>Change in output per job</b></i>—Output per job is a crude measure of a metropolitan economy’s productivity, or how much value is generated per job.</li><li><i><b>Change in the average wage</b></i>—Average wage measures the aggregate income of a metropolitan economy on a per-job basis.</li><li><i><b>Change in output per person</b></i>—Output per person measures the size of the metropolitan economy on a per-person basis, including people of all ages regardless of labor force status, and thus indicates the general standard of living.</li></ul><p>Changes in these indicators are measured as the percent difference between values in the final and initial years of analysis. Data on output, jobs, and aggregate income come from Moody’s Analytics. Data on population come from the U.S. Census Bureau’s Population Estimates Program.</p><p><b>Inclusion</b></p><p>Inclusion indicators measure how the benefits of growth and prosperity in a metropolitan economy—specifically, income and employment opportunity—are distributed among people. People who benefit from growth have more opportunities to fulfill their and their children’s potential. They can also purchase more of the goods and services the metropolitan economy produces. Inclusive growth can thus increase the amount of current and future human capital available in an economy, and raise the amount of demand, boosting both its prosperity and growth. Ensuring that all people can contribute to and benefit from growth and prosperity also helps sustain widespread support for the policies on which growth and prosperity depend.</p><ul><li><i><b>Change in the median wage</b></i>—Median wage measures the annual income earned by a person who earns more than exactly half of workers in the metropolitan economy, among people at least 16 years old who earned income in the last year.</li><li><i><b>Change in the relative income poverty rate</b></i>—Commonly used to measure poverty in other countries, this measures the share of workers in the metropolitan economy who earn less than half of the median annual wage in that metropolitan economy. This measures poverty relative to local costs of living and captures the distribution of income among workers earning below the median.</li><li><i><b>Change in the employment rate</b></i>—The employment-to-population ratio measures the share of individuals aged 18 to 65 who are currently employed.</li></ul><p>Change in median wage is measured as the percent difference between values in the final and initial years of analysis. Changes in relative income poverty and employment rates are measured as the percentage point difference between rates in the final and initial years of analysis. Data for inclusion indicators come from the Census Public-Use Microdata Series (PUMS) for the 2000 Decennial Census and the 2006 to 2014 American Community Survey (ACS) 1-year estimates. Estimates derived from survey data come with estimates of survey error, which are reported on the series website.</p>")

	});
		

	/////////////////base view

	(function(){
		var colors = ['#d7191c','#fdae61','#ffffbf','#abd9e9','#2c7bb6'];
		var colors = ['#e66101','#fdb863','#f7f7f7','#b2abd2','#5e3c99'];
		var colors = ['#d01c8b','#f1b6da','#f7f7f7','#b8e186','#4dac26'];
		var colors = ['#053769', '#a4c7f2', '#dddddd', '#ffa626', '#ff5e1a'];
		//colors.reverse();

		function r2c(r){
			var q = null;
			var t = "#ffffff";
			var td = "#666666";
			if(r<=20){q=0}
			else if(r<=40){q=1; t=td;}
			else if(r<=60){q=2; t=td;}
			else if(r<=80){q=3;}
			else if(r<=100){q=4}
			else{q=null}
			return {fill:colors[q], text:t};
		}
		
		//hold svg groups -- will be defined in setupBase

		var columns = [{}, {}];

		function drawTable(){
			var VO = this;
			var table = this.storage("table");
			var data = this.viewData("processed");
			var period = this.storage("period");

			var rows = table.selectAll("g.table-row").data(data.universe);
			var rowenter = rows.enter().append("g").style("pointer-events","all").classed("table-row",true);
			//rowenter.append("rect").attr({"x":-15, "y":0, "width":"400px", "height":"60px", "fill":"#ffffff"}).classed("pointer-rect",true)
			rowenter.append("rect").attr({"x":0, "y":0, "width":"100%", "height":"60px", "fill":"#ffffff"}).classed("back-rect",true).style("shape-rendering","crispEdges");
			rowenter.append("text").attr({"x":"1.5%", "y":20}).style("font-size","15px");
			rowenter.append("line").attr({"x1":0, "x2":"100%", "y1":60, "y2":60, "stroke":"#666666", "stroke-width":"1px"}).style("shape-rendering","crispEdges");

			rows.exit().remove("g");
			rows.attr("transform",function(d,i){
				return "translate(0," + ((i*61)) + ")";
			})

			var shiftTimer;
			rows.on("mouseenter",function(d,i){
				clearTimeout(shiftTimer);
				var thiz = d3.select(this);
				//thiz.select("rect.pointer-rect").attr("height","160px");
				thiz.select("rect.back-rect").attr({"height":"160px","fill":"#ffffff"});
				thiz.select("line").attr({"y1":160, "y2":160});
				rows.attr("transform",function(d,j){
					var buffer = j > i ? 100 : 0;
					return "translate(0," + ((j*61)+buffer) + ")";
				})
			});
			rows.on("mouseleave",function(d,i){
				clearTimeout(shiftTimer);
				var thiz = d3.select(this);
				//thiz.select("rect.pointer-rect").attr("height","60px");
				thiz.select("rect.back-rect").attr({"height":"60px", "fill":"#ffffff"});
				thiz.select("line").attr({"y1":60, "y2":60});
				rows.attr("transform",function(d,j){
					var buffer = 0;
					return "translate(0," + ((j*61)+buffer) + ")";
				})


			});

			rows.select("text").text(function(d,i){return VO.lookup[d][0].CBSA_Title});

			var swatches = rows.selectAll("g.swatch").data(function(d,i){
				var metro = data.table[d];
				var keyR = period+"R";
				var keyV = period+"V";
				return [metro.gr0[keyR], metro.pro0[keyR], metro.inc0[keyR]];
			});
			var eSwatches = swatches.enter().append("g").classed("swatch",true);
			eSwatches.append("rect").attr({"width":"30%","height":20,"y":30}).style("shape-rendering","crispEdges").attr("x",function(d,i){return ((i*33)+1.5)+"%"});
			eSwatches.append("text").attr({"y":45,"text-anchor":"middle"}).style({"font-size":"13px","line-height":"13px"}).attr("x",function(d,i){return ((i*33)+15+1.5)+"%"});

			swatches.exit().remove();
			//swatches.attr("transform", function(d,i){return "translate("+"(15,26)"});

			swatches.select("rect").attr("fill",function(d,i){return (r2c(d)).fill});
			swatches.select("text").text(function(d,i){return d}).style("fill",function(d,i){return (r2c(d)).text});

			//var topline = table.selectAll("line.top-line").data([0]).enter().append("line").attr({"x1":0, "x2":"100%", "y1":0, "y2":0, "stroke":"#666666", "stroke-width":"1px"}).style("shape-rendering","crispEdges");
		}

		//redraw -- setup is just to add html
		function redrawBase(){
			if(!this.viewData("processed")){
				var data = {};
				data.table = {};
				function putInTable(A,propName){
					for(var i=0; i<A.length; i++){
						var prop = A[i].CBSA+"";
						if(!data.table.hasOwnProperty(prop)){data.table[prop] = {}}
						data.table[prop][propName] = A[i];
					}
				}
				putInTable(this.viewData("raw").measures.growth.overall, "gr0");
				putInTable(this.viewData("raw").measures.growth.detailed, "gr1");
				putInTable(this.viewData("raw").measures.prosperity.overall, "pro0");
				putInTable(this.viewData("raw").measures.prosperity.detailed, "pro1");
				putInTable(this.viewData("raw").measures.inclusion.overall, "inc0");
				putInTable(this.viewData("raw").measures.inclusion.detailed, "inc1");

				data.universe = this.viewData("raw").measures.growth.overall.map(function(d,i){return d.CBSA+""});
				this.viewData("processed",data);
			}

			drawTable.call(this);
			//vAlign(this.storage("mapWrap"), this.container);

			//calculate svg height
			var tnode = this.storage("table").node();
			var box = tnode.getBoundingClientRect();
			d3.select(tnode.parentNode).style("height", (Math.round(box.bottom-box.top)+125)+"px");
		}

		var alignTimer;
		function vAlign(mapWrap, container){
			//var mBox = mapWrap.getBoundingClientRect();
			var cBox = container.node().getBoundingClientRect();
			var top = cBox.top;
			//clearTimeout(alignTimer);
			//alignTimer = setTimeout(function(){
				if(top >= 0){
					mapWrap.style({"position":"relative","top":"0px","margin-top":"0px"});
				}
				else if(1==2){

				}
				else{
					var off = 0-top;
					mapWrap.style({"position":"fixed","top":"0px","margin-top":"0px"});
				}
			//},300);
		}

		var setupBase = function(){
			this.header.append("p").text("Growth, prosperity, and inclusion in the 100 largest U.S. metro areas");
			//var tableWrap = this.container.append("div").style({"padding":"5px 0px 5px 0px", "border":"1px solid #dddddd", "border-width":"1px 0px 1px 0px"}).classed("two-fifths",true).append("div").style("max-height","600px");
			var mapWrap = this.container.append("div").classed("three-fifths no-mobile-display",true).append("div").style({"padding":"0px 30px 0px 0px","position":"relative"});
			var smallMaps = mapWrap.append("div").classed("c-fix",true).selectAll("div").data([0,1,2]).enter().append("div")
								   .style({"width":"50%","padding-left":"0px","float":"left"}).style("clear",function(d,i){return i <= 1 ? "none" :"both"});
			smallMaps.each(function(d,i){
				var map = new dotMap(this).drawMap().makeResponsive();
			})

			var container = this.container.append("div").classed("two-fifths",true).style({"max-height":"750px","border":"1px solid #666666","border-width":"1px 0px 1px 0px"});
			var tableWrap = container.append("div").style("padding","0px 10px 0px 0px");
			var table = tableWrap.append("svg").style("width","100%").append("g").attr("id","core-svg-table");



			var map0 = new dotMap(mapWrap.node()).drawMap().makeResponsive();
			map0.showOverlay();
			setTimeout(function(){map0.hideOverlay()},5000);
			//map0.setData(DAT).drawMap(callback).makeResponsive().showTooltips(textData);

			this.storage("table", table); //store these in the view state
			this.storage("tableWrap", tableWrap);

			this.storage("mapWrap", mapWrap);
			this.storage("period","Five");

			/*window.addEventListener("scroll",function(){
				vAlign(mapWrap, container);
			})*/
		}

		var view1 = MI.addView(redrawBase, "coreIndicators.json", setupBase);
		view1.name("Growth, prosperity, and inclusion");
	})();

	var view2 = MI.addView(function(){
		this.container.append("p").text("Metro Index");
	}, null, function(){this.header.append("p").text("Outcomes by race")})

	var view3 = MI.addView(function(){}, null, function(){
		this.header.append("p").text("Stay tuned for...");
		this.container.append("p").text("Industrial structure... [February 2016]");
		this.container.append("p").text("Lorem ipsum [February 2016]");
		this.container.append("p").text("Lorem ipsum [March 2016]");
	})

	//MI.metro = "10140" //can set the default
	
	view0.name("About");
	
	view2.name("Inclusion by race");
	view3.name("Upcoming Metro Monitor research")

	MI.cap(); //tell the app to try and auto-draw based on hash and defaults
</script>


</body>
</html>
